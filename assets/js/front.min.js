function waymark_setup_map_export(){jQuery(".waymark-map-export").each((function(){var e=jQuery(this);if(e){var a=e.parents(".waymark-meta-export_data"),t=(jQuery("a",e),jQuery("select",e));"undefined"!=typeof Waymark&&Waymark.map.on("layerremove layeradd",(function(){var e=0;Waymark.map_data.eachLayer((function(a){Waymark.map.hasLayer(a)&&e++})),e>0?a.show():a.hide()})),e.on("submit",(function(a){var o=t.val()?t.val():"geojson",r=Waymark_L.layerGroup();Waymark.map_data.eachLayer((function(e){if(Waymark.map.hasLayer(e)){for(key in e.feature.properties)void 0!==e.feature.properties[key]?"title"==key&&"kml"==o&&(e.feature.properties.name=e.feature.properties[key],delete e.feature.properties[key]):delete e.feature.properties[key];r.addLayer(e)}}));var n=r.toGeoJSON();switch(t.val()){case"gpx":var i=togpx(n),c="gpx";break;case"kml":i=tokml(n),c="kml";break;default:case"geojson":i=JSON.stringify(n),c="geojson"}e.data("map_slug"),e.data("map_id");var s=jQuery('input[name="map_data"]',e);console.log(i),s.val(encodeURIComponent(i))}))}}))}function waymark_setup_parameter_tooltips(){jQuery("a.waymark-tooltip").on({mouseenter:function(e){var a=jQuery(this).data("title");jQuery('<p id="waymark-tooltip-active"></p>').text(a).appendTo("body").fadeIn("slow")},mouseleave:function(e){jQuery("#waymark-tooltip-active").remove()},mousemove:function(e){if(waymark_is_touch_device())var a=e.pageX-250;else a=e.pageX-220;var t=e.pageY+5;jQuery("#waymark-tooltip-active").css({top:t,left:a})}})}function waymark_is_touch_device(){var e=" -webkit- -moz- -o- -ms- ".split(" ");return!!("ontouchstart"in window||window.DocumentTouch&&document instanceof DocumentTouch)||function(e){return window.matchMedia(e).matches}(["(",e.join("touch-enabled),("),"heartz",")"].join(""))}function waymark_setup_accordions(){var e=jQuery(".waymark-accordion-container");e.length&&(e.addClass("waymark-self-clear"),e.each((function(){var e=0;jQuery(".waymark-accordion-group",jQuery(this)).each((function(){jQuery(this).addClass("waymark-self-clear"),jQuery(this).data("waymark-index",e);var a=jQuery(".waymark-accordion-group-content",jQuery(this));0==e?(jQuery(this).addClass("waymark-first"),a.show().addClass(e)):a.hide().addClass(e),jQuery("legend",jQuery(this)).each((function(){var e=jQuery(this).html();-1==e.indexOf("[+]")&&jQuery(this).html(e+" <span>[+]</span>"),jQuery(this).click((function(){var e=jQuery(this).parents(".waymark-accordion-group").data("waymark-index");jQuery(".waymark-accordion-group",jQuery(this).parents(".waymark-accordion-container")).each((function(){jQuery(this).data("waymark-index")==e?jQuery(".waymark-accordion-group-content",jQuery(this)).slideDown():jQuery(".waymark-accordion-group-content",jQuery(this)).slideUp()}))}))})),e++}))})))}function waymark_setup_map_shortcode(){jQuery(".waymark-shortcode").each((function(){var e=jQuery(this);jQuery(".waymark-header",e).each((function(){var a=jQuery(this),t=jQuery(".waymark-link",a).first(),o=jQuery(".waymark-meta",a);if(o.length){var r=jQuery(".waymark-map-export",o).length,n=jQuery(".waymark-meta-item",o);r&&n.length;t.on("click",(function(){return o.show(),!1})),jQuery("i",t).attr("class","ion ion-map"),o.css("height",e.height()+"px");var i=jQuery("<i />").attr({class:"waymark-meta-close ion ion-close"}).on("click",(function(){o.hide()}));o.append(i)}}))}))}!function(e,a){if("function"==typeof define&&define.amd)define([],a);else if("undefined"!=typeof exports)a();else{a(),e.FileSaver={}}}(this,(function(){"use strict";var e="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof global&&global.global===global?global:void 0;function a(e,a,t){var o=new XMLHttpRequest;o.open("GET",e),o.responseType="blob",o.onload=function(){n(o.response,a,t)},o.onerror=function(){console.error("could not download file")},o.send()}function t(e){var a=new XMLHttpRequest;a.open("HEAD",e,!1);try{a.send()}catch(e){}return a.status>=200&&a.status<=299}function o(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(t){var a=document.createEvent("MouseEvents");a.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(a)}}var r=/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),n=e.saveAs||("object"!=typeof window||window!==e?function(){}:"download"in HTMLAnchorElement.prototype&&!r?function(r,n,i){var c=e.URL||e.webkitURL,s=document.createElement("a");n=n||r.name||"download",s.download=n,s.rel="noopener","string"==typeof r?(s.href=r,s.origin!==location.origin?t(s.href)?a(r,n,i):o(s,s.target="_blank"):o(s)):(s.href=c.createObjectURL(r),setTimeout((function(){c.revokeObjectURL(s.href)}),4e4),setTimeout((function(){o(s)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,r,n){if(r=r||e.name||"download","string"==typeof e)if(t(e))a(e,r,n);else{var i=document.createElement("a");i.href=e,i.target="_blank",setTimeout((function(){o(i)}))}else navigator.msSaveOrOpenBlob(function(e,a){return void 0===a?a={autoBom:!1}:"object"!=typeof a&&(console.warn("Deprecated: Expected third argument to be a object"),a={autoBom:!a}),a.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob([String.fromCharCode(65279),e],{type:e.type}):e}(e,n),r)}:function(t,o,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof t)return a(t,o,n);var c="application/octet-stream"===t.type,s=/constructor/i.test(e.HTMLElement)||e.safari,u=/CriOS\/[\d]+/.test(navigator.userAgent);if((u||c&&s||r)&&"undefined"!=typeof FileReader){var d=new FileReader;d.onloadend=function(){var e=d.result;e=u?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},d.readAsDataURL(t)}else{var l=e.URL||e.webkitURL,y=l.createObjectURL(t);i?i.location=y:location.href=y,i=null,setTimeout((function(){l.revokeObjectURL(y)}),4e4)}});e.saveAs=n.saveAs=n,"undefined"!=typeof module&&(module.exports=n)})),jQuery(document).ready((function(){waymark_setup_parameter_tooltips(),waymark_setup_map_export(),waymark_setup_accordions()})),jQuery(document).ready((function(){waymark_setup_map_shortcode()}));